
<!DOCTYPE html>
<html lang='en'>
<head>
<title>Securing a Cloud SQL for PostgreSQL Instance | Qwiklabs</title>
<meta name="action-cable-url" content="/cable" />
<script>
//<![CDATA[
window.gon={};gon.deployment="googlecoursera-run";
//]]>
</script>
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-5XSKHDX");
</script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/polyfills/webcomponents-loader-8583b47b01e40e6ea7bf1ad443a20b7e79bbdd5eafac009806a228c91a97282c.js"></script>
<script src="https://cdn.qwiklabs.com/assets/vendor-613520545532a2795a401a8168ca8b698b9ee765a66f5ad9ead806b5c32eabe8.js"></script>
<script src="https://cdn.qwiklabs.com/assets/application-b4c1ba27bff5cfc342d726ccb6d3a8cb4b5ac06e2e4f81b428783b0e94509b48.js"></script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/hallofmirrors-6a75474522419d1502d269c186ad8e9615ea8ffb93b320075299479d1255b437.js"></script>
<!--[if lt IE 9]>  <![endif]-->
<script src='http://html5shim.googlecode.com/svn/trunk/html5.js' type='text/javascript'></script>
<!--[endif]>  <![endif]-->
<script id='ze-snippet' src='https://static.zdassets.com/ekr/snippet.js?key=511e4158-0aec-4e3c-b2e6-4daa1769f51e'></script>


<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="tJSR4yexTdPJSOVHQMebBFyrhr9IDGjeobdh7c1uKTprFvz+gDQSIZv8p7nBIeHkph1sLhO/iV6kDkfApATc4w==" />
<meta content='width=device-width, initial-scale=1.0, user-scalable=yes' name='viewport'>
<meta content='1rRsY0INj8RvwB5EF5pwdxt2A2P9aDgAlsICaJ0d5w0' name='google-site-verification'>
<meta content='#3681E4' property='msapplication-TileColor'>
<meta content='/favicon-144.png' property='msapplication-TileImage'>
<meta content='[{&quot;id&quot;:&quot;recaptcha_experiment&quot;,&quot;optimize_id&quot;:&quot;dpViOcLkT3qS4TvL2mRojA&quot;,&quot;title&quot;:&quot;No Recaptcha shown for trusted users&quot;,&quot;variant_index&quot;:1,&quot;variant&quot;:&quot;no_recaptcha&quot;}]' name='active-experiments'>
<meta content='{&quot;userId&quot;:12197799,&quot;experimentIds&quot;:[&quot;course_upgrade&quot;,&quot;canonical_domain_redirect&quot;,&quot;show_annual_purchase_now&quot;,&quot;search_updates&quot;,&quot;oauth_risc_shutoff&quot;,&quot;chat_off_for_signed_out_users&quot;,&quot;teams&quot;,&quot;enforce_codebuild_verdicts&quot;,&quot;community_forum&quot;,&quot;peer_assignment&quot;,&quot;program_resources&quot;,&quot;barker&quot;,&quot;program_learning_assignment&quot;,&quot;pre_course_quest_migration&quot;,&quot;program_groups&quot;,&quot;alexandria_show_bundle_errors&quot;,&quot;programs&quot;,&quot;used_in&quot;]}' name='help-api-product-data'>
<meta content='{&quot;groupIds&quot;:[&quot;non_suadmins&quot;,&quot;students&quot;,&quot;non_organization&quot;,&quot;non_program&quot;]}' name='help-api-custom-data'>
<meta content='In this lab you will deploy a new Cloud SQL instance using a customer-managed encryption key (CMEK). You will configure pgAudit to selectively record and track SQL operations performed against that instance, then you will configure and test Cloud SQL IAM database authentication.' name='description'>
<meta content='Qwiklabs' name='author'>
<meta content='Securing a Cloud SQL for PostgreSQL Instance | Qwiklabs' property='og:title'>
<meta content='website' property='og:type'>
<meta content='/favicon-144.png' property='og:image'>
<meta content='Qwiklabs' property='og:site_name'>
<meta content='In this lab you will deploy a new Cloud SQL instance using a customer-managed encryption key (CMEK). You will configure pgAudit to selectively record and track SQL operations performed against that instance, then you will configure and test Cloud SQL IAM database authentication.' property='og:description'>
<meta content='/qwiklabs_logo_900x887.png' property='og:logo' size='900x887'>
<meta content='/qwiklabs_logo_994x187.png' property='og:logo' size='994x187'>


<meta property="og:url" content="https://googlecoursera.qwiklabs.com/focuses/30764401?parent=lti_session" /><link href="https://googlecoursera.qwiklabs.com/focuses/30764401?parent=lti_session" rel="canonical" />
<link color='#3681E4' href='/favicon-svg.svg' rel='mask-icon'>
<link href='/favicon-180.png' rel='apple-touch-icon-precomposed'>
<link href='/favicon-32.png' rel='shortcut icon' type='image/x-icon'>


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald:400|Roboto+Mono:400,700|Roboto:300,400,500,700|Google+Sans:300,400,500,700|Google+Sans+Display:400|Material+Icons|Google+Material+Icons|Google+Sans+Text:400,500,700" media="screen" />

<link rel="stylesheet" href="https://cdn.qwiklabs.com/assets/application-de99c9a7d498d77141405f7054ca08b1e88a44676934f8cf8a3e6f2e0bbc55b4.css" media="all" />


<style>
  :root {
    --primary-text-on-surface-color: #1a73e8;
    --primary-text-on-surface-color-dark: #1568d6;
    --primary-text-on-surface-color-darker: #135ec1;
    --primary-text-on-surface-color-darkest: #1154ac;
    --primary-surface-color: #1a73e8;
    --primary-surface-color-rgb: 26,115,232;
    --primary-surface-color-light: #d1e3fa;
    --primary-surface-color-lightest: #e8f1fd;
    --text-on-primary-color: #ffffff;
    --accent-text-on-surface-color: #f29900;
    --accent-surface-color: #f9ab00;
    --accent-surface-color-rgb: 249,171,0;
    --accent-surface-color-light: #ffefcc;
    --text-on-accent-color: #202124;
  }
</style>

<style>
  :root {
    --navbar-height: 64px;
  }
</style>



</head>
<body class='lab-show l-full no-nav application-new focuses focuses-show lab-show l-full no-nav '>
<div class='header-container'>
<div class='header'>
<ql-toolbar jumpEnabled>
<div class='header__title' slot='title'>
<ql-icon-button label="Back" href="https://www.coursera.org/" id="32f7a3220e4c878a" target="_self" tip="Back">arrow_back</ql-icon-button>
<h1 class='ql-headline-6'>Securing a Cloud SQL for PostgreSQL Instance</h1>
</div>
<div class='header__actions' slot='action'>
<ql-icon-button id='control-panel-target' style='display: none;'>
dashboard
</ql-icon-button>
<ql-menu for='control-panel-target' id='control-panel-menu'></ql-menu>
<ql-icon-button class='mobile-hide' icon='help_outline' id='help-menu-button' label='Open help menu' tip='Help'></ql-icon-button>
<ql-menu for='help-menu-button' id='help-menu'>
<ql-menu-item data-analytics-action='opened_help' data-analytics-label='lab' label='Help Center' onclick='hallofmirrors.helpService.startHelp({&quot;productData&quot;:{&quot;userId&quot;:12197799},&quot;context&quot;:&quot;lab&quot;})'></ql-menu-item>
<ql-menu-item href='mailto:support@qwiklabs.com' label='Email support'></ql-menu-item>
<ql-menu-item label='Chat support' onClick='ql.chat.open()'></ql-menu-item>
</ql-menu>

<ql-icon-button class='mobile-hide' icon='language' id='language' label='Select your language preference' tip='Language'></ql-icon-button>
<ql-menu for='language'>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ar' href='/focuses/30764401?locale=ar&amp;parent=lti_session' label='العربية‬‎' lang='ar'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='de' href='/focuses/30764401?locale=de&amp;parent=lti_session' label='Deutsch' lang='de'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='en' href='/focuses/30764401?locale=en&amp;parent=lti_session' label='English' lang='en'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='es' href='/focuses/30764401?locale=es&amp;parent=lti_session' label='español (Latinoamérica)' lang='es'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='fr' href='/focuses/30764401?locale=fr&amp;parent=lti_session' label='français' lang='fr'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='fr_CA' href='/focuses/30764401?locale=fr_CA&amp;parent=lti_session' label='français (Canada)' lang='fr-CA'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='he' href='/focuses/30764401?locale=he&amp;parent=lti_session' label='עברית' lang='he'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='id' href='/focuses/30764401?locale=id&amp;parent=lti_session' label='bahasa Indonesia' lang='id'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='it' href='/focuses/30764401?locale=it&amp;parent=lti_session' label='Italiano' lang='it'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ja' href='/focuses/30764401?locale=ja&amp;parent=lti_session' label='日本語' lang='ja'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ko' href='/focuses/30764401?locale=ko&amp;parent=lti_session' label='한국어' lang='ko'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='pl' href='/focuses/30764401?locale=pl&amp;parent=lti_session' label='Polski' lang='pl'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='pt_BR' href='/focuses/30764401?locale=pt_BR&amp;parent=lti_session' label='português (Brasil)' lang='pt-BR'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='pt_PT' href='/focuses/30764401?locale=pt_PT&amp;parent=lti_session' label='português (Portugal)' lang='pt-PT'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ru' href='/focuses/30764401?locale=ru&amp;parent=lti_session' label='русский' lang='ru'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='tr' href='/focuses/30764401?locale=tr&amp;parent=lti_session' label='Türkçe' lang='tr'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='uk' href='/focuses/30764401?locale=uk&amp;parent=lti_session' label='український' lang='uk'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='zh' href='/focuses/30764401?locale=zh&amp;parent=lti_session' label='简体中文' lang='zh'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='zh_TW' href='/focuses/30764401?locale=zh_TW&amp;parent=lti_session' label='繁體中文' lang='zh-TW'></ql-menu-item>
</ql-menu>


<ql-icon-button id='my_account' label='My account' tip='My account'>
<ql-avatar src='https://lh3.googleusercontent.com/a/ACg8ocI6s7UhNvX_oCOJMPhLJPmqhqIgwu_5AK0t7wpjF-5jmQo=s320-c'></ql-avatar>
</ql-icon-button>
<ql-menu for='my_account' id='my_account_menu' style='max-height: 640px'>
<div class='my-account-menu'>
<ql-avatar class='l-mtl l-mbl' size='120' src='https://lh3.googleusercontent.com/a/ACg8ocI6s7UhNvX_oCOJMPhLJPmqhqIgwu_5AK0t7wpjF-5jmQo=s320-c'></ql-avatar>
<div class='my-account-menu__user-info l-mbl'>
<h4 class='ql-subhead-1'>Justin Ho</h4>
<p class='ql-body-2 text--light'>cliffdove@gmail.com</p>
<p class='ql-body-2 text--light'>
</p>
<a class="text--green ql-subhead-2" href="/my_account/payments"><ql-chip positive>
0 Credits
</ql-chip>
</a></div>
<div class='buttons l-mbl'>
<a class="button button--hairline" id="settings" href="/my_account/profile">Settings</a>
</div>
<hr>
<ql-button data-analytics-action='clicked_sign_out' href='/users/sign_out' method='delete'>
Sign Out
</ql-button>
<div class='privacy l-mtl'>
<a target="_blank" class="ql-caption text--light" href="/privacy_policy">Privacy</a>
<span class='ql-caption text--light l-mls l-mrs'>&middot;</span>
<a class="ql-caption text--light" href="/terms_of_service">Terms</a>
</div>
</div>
</ql-menu>

</div>
</ql-toolbar>

</div>
</div>

<nav class='nav-panel js-nav-panel'>
<div class='nav-panel__logo'>
<div class="custom-logo">Qwiklabs</div>
</div>
<nav class='ql-sidenav'>
<ql-sidenav-item href='/' icon='home' label='Home'></ql-sidenav-item>

<ql-sidenav-item href='/catalog' icon='school' label='Catalog'></ql-sidenav-item>

<ql-sidenav-item href='/profile' icon='event_note' label='Profile'></ql-sidenav-item>

</nav>

</nav>
<div class='nav-panel__overlay js-nav-toggle'></div>

<main class='js-main' id='jump-content'>
<div class='l-main-wrapper' id='main-wrapper'>




<div class='lab-assessment__tab js-open-lab-assessment-panel'>
<button class='js-lab-assessment-total-score'>
—/100
</button>
</div>
<div aria-labelledby='lab-assessment-checkpoint' class='lab-assessment__panel js-lab-assessment-panel' role='dialog'>
<div class='lab-assessment__panel__header'>
<h4 id='lab-assessment-checkpoint'>Checkpoints</h4>
<ql-icon-button class='js-close-lab-assessment-panel' icon='arrow_forward' label='Close dialog'></ql-icon-button>
</div>
<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Create a Cloud SQL for PostgreSQL instance with CMEK enabled
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Create a Cloud SQL for PostgreSQL instance with CMEK enabled' step_no='1'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-1'>
</span>
/ 40
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Enable and configure pgAudit on a Cloud SQL for PostgreSQL database
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Enable and configure pgAudit on a Cloud SQL for PostgreSQL database' step_no='2'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-2'>
</span>
/ 30
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Configure Cloud SQL IAM database authentication
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Configure Cloud SQL IAM database authentication' step_no='3'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-3'>
</span>
/ 30
</p>
</div>
</div>

</div>
<ql-drawer-container class='js-lab-state' data-analytics-payload='{&quot;label&quot;:&quot;Securing a Cloud SQL for PostgreSQL Instance&quot;,&quot;lab_name&quot;:&quot;Securing a Cloud SQL for PostgreSQL Instance&quot;,&quot;classroom_name&quot;:null,&quot;deployment&quot;:&quot;googlecoursera-run&quot;}' data-credits='0.0' data-focus-id='30764401' data-lab-billing-limit='0.0' data-lab-duration='3600' data-parent='lti_session' data-recaptcha-enabled id='lab-container'>
<ql-drawer id='terminal-drawer' slot='drawer'>
<iframe allow='clipboard-read' class='terminal' id='embedded-resource'></iframe>
</ql-drawer>
<ql-drawer-content class='js-lab-wrapper' id='lab-content' slot='drawer-content'>
<ql-drawer-container id='lab-content-container'>
<ql-drawer id='control-panel-drawer' open slot='drawer' width='320'>
<ql-lab-control-panel class='ql-lab-control-panel__max-height control-panel js-lab-control-panel' connectionFiles='[]' labControlButton='{&quot;disabled&quot;:false,&quot;pending&quot;:false,&quot;running&quot;:false}' labDetails='[]' labTimer='{&quot;ticking&quot;:false,&quot;secondsRemaining&quot;:3600}' studentResources='[]'>
<script src="https://www.recaptcha.net/recaptcha/api.js?render=6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr"   ></script>
        <script>
          // Define function so that we can call it again later if we need to reset it
          // This executes reCAPTCHA and then calls our callback.
          function executeRecaptchaForStartLab() {
            grecaptcha.ready(function() {
              grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}).then(function(token) {
                setInputWithRecaptchaResponseTokenForStartLab('g-recaptcha-response-data-start-lab', token)
              });
            });
          };
          // Invoke immediately
          executeRecaptchaForStartLab()

          // Async variant so you can await this function from another async function (no need for
          // an explicit callback function then!)
          // Returns a Promise that resolves with the response token.
          async function executeRecaptchaForStartLabAsync() {
            return new Promise((resolve, reject) => {
             grecaptcha.ready(async function() {
                resolve(await grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}))
              });
            })
          };

                  var setInputWithRecaptchaResponseTokenForStartLab = function(id, token) {
          var element = document.getElementById(id);
          if (element !== null) element.value = token;
        }

        </script>
<input type="hidden" name="g-recaptcha-response-data[start_lab]" id="g-recaptcha-response-data-start-lab" data-sitekey="6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr" class="g-recaptcha g-recaptcha-response "/>

<div aria-live='polite' class='hidden' id='recaptcha-v2-start-lab' slot='recaptcha'>
<script src="https://www.recaptcha.net/recaptcha/api.js" async defer ></script>
<div data-sitekey="6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV" data-callback="recaptchaComplete" data-expired-callback="expireV2Token" class="g-recaptcha "></div>
          <noscript>
            <div>
              <div style="width: 302px; height: 422px; position: relative;">
                <div style="width: 302px; height: 422px; position: absolute;">
                  <iframe
                    src="https://www.recaptcha.net/recaptcha/api/fallback?k=6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV"
                    name="ReCAPTCHA"
                    style="width: 302px; height: 422px; border-style: none; border: 0; overflow: hidden;">
                  </iframe>
                </div>
              </div>
              <div style="width: 300px; height: 60px; border-style: none;
                bottom: 12px; left: 25px; margin: 0px; padding: 0px; right: 25px;
                background: #f9f9f9; border: 1px solid #c1c1c1; border-radius: 3px;">
                <textarea id="g-recaptcha-response" name="g-recaptcha-response"
                  class="g-recaptcha-response"
                  style="width: 250px; height: 40px; border: 1px solid #c1c1c1;
                  margin: 10px 25px; padding: 0px; resize: none;">
                </textarea>
              </div>
            </div>
          </noscript>

</div>
</ql-lab-control-panel>
</ql-drawer>
<ql-drawer-content id='lab-instructions' slot='drawer-content'>
<div class='lab-content-container'>
<div class='alert alert--fake js-alert'>
<p class='alert__message js-alert-message' role='alert'></p>
<ql-icon-button class='alert__close js-alert-close' icon='clear'></ql-icon-button>
<iframe class='l-ie-iframe-fix' tabindex='-1'></iframe>
</div>
<div class='lab-content__renderable-instructions js-lab-content'>
<div class='lab-preamble'>
<h1 class='lab-preamble__title'>
Securing a Cloud SQL for PostgreSQL Instance
</h1>
<div class='lab-preamble__details subtitle-headline-1'>
<span>1 hour </span>
<span>Free</span>
<div class='lab__rating'>
<a aria-label="Lab Reviews" href="/focuses/30764401/reviews?parent=lti_session"><div class='rateit' data-rateit-readonly='true' data-rateit-value='4.3684'></div>

</a></div>
</div>
</div>
<div class='lab-outline-place-holder'></div>

<div class='markdown-lab-instructions js-markdown-instructions' id='markdown-lab-instructions'>

<h2 id="step1">GSP920</h2>
<p><img alt="Google Cloud self-paced labs logo" src="https://cdn.qwiklabs.com/GMOHykaqmlTHiqEeQXTySaMXYPHeIvaqa2qHEzw6Occ%3D"></p>
<h2 id="step2">Overview</h2>
<p>This lab will provide you with step-by-step guidance on how to secure a Cloud SQL for PostgreSQL instance. You will deploy a new Cloud SQL instance using a customer-managed encryption key (CMEK). The CMEK feature lets you use your own cryptographic keys for data at rest in Cloud SQL. After adding customer-managed encryption keys, whenever an API call is made, Cloud SQL uses your key to access data. Once you have created the Cloud SQL for PostgreSQL instance you will configure pgAudit to selectively record and track SQL operations performed against that instance and finally you will configure and test Cloud SQL IAM database authentication.</p>
<h3>Objectives</h3>
<p>You will learn how to perform the following tasks:</p>
<ul>
<li>
<p>Setup CMEK for Cloud SQL for PostgreSQL.</p>
</li>
<li>
<p>Enable and configure pgAudit on a Cloud SQL for PostgreSQL instance.</p>
</li>
<li>
<p>Configure Cloud SQL for PostgreSQL IAM database authentication.</p>
</li>
</ul>
<h3>Target Audience</h3>
<p>The content of this hands-on lab will be most applicable to PostgreSQL DBAs.  This lab is designed to give professionals hands-on experience setting up and configuring Google Cloud resources to support PostgreSQL.</p>
<h2 id="step3">Setup and requirements</h2>
<h3>Before you click the Start Lab button</h3>
<p>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click <strong>Start Lab</strong>, shows how long Google Cloud resources will be made available to you.</p>
<p>This hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</p>
<p>To complete this lab, you need:</p>
<ul>
<li>Access to a standard internet browser (Chrome browser recommended).</li>
</ul>
<ql-warningbox>
<strong>Note:</strong> Use an Incognito or private browser window to run this lab. This prevents any conflicts between your personal account and the Student account, which may cause extra charges incurred to your personal account.
</ql-warningbox>
<ul>
<li>Time to complete the lab---remember, once you start, you cannot pause a lab.</li>
</ul>
<ql-warningbox>
<strong>Note:</strong> If you already have your own personal Google Cloud account or project, do not use it for this lab to avoid extra charges to your account.
</ql-warningbox>
<h3>How to start your lab and sign in to the Google Cloud Console</h3>
<ol>
<li>
<p>Click the <strong>Start Lab</strong> button. If you need to pay for the lab, a pop-up opens for you to select your payment method.
On the left is the <strong>Lab Details</strong> panel with the following:</p>
<ul>
<li>The <strong>Open Google Console</strong> button</li>
<li>Time remaining</li>
<li>The temporary credentials that you must use for this lab</li>
<li>Other information, if needed, to step through this lab</li>
</ul>
</li>
<li>
<p>Click <strong>Open Google Console</strong>.
The lab spins up resources, and then opens another tab that shows the <strong>Sign in</strong> page.</p>
<p><strong><em>Tip:</em></strong> Arrange the tabs in separate windows, side-by-side.</p>
<ql-infobox>
<strong>Note: </strong>If you see the <strong>Choose an account</strong> dialog, click <strong>Use Another Account</strong>.        
 </ql-infobox>
</li>
<li>
<p>If necessary, copy the <strong>Username</strong> from the <strong>Lab Details</strong> panel and paste it into the <strong>Sign in</strong> dialog. Click <strong>Next</strong>.</p>
</li>
<li>
<p>Copy the <strong>Password</strong> from the <strong>Lab Details</strong> panel and paste it into the <strong>Welcome</strong> dialog. Click <strong>Next</strong>.</p>
<ql-infobox>
<strong>Important: </strong>You must use the credentials from the left panel. Do not use your Google Cloud Skills Boost credentials. 
 </ql-infobox>
<ql-warningbox>
<strong>Note: </strong>Using your own Google Cloud account for this lab may incur extra charges.
 </ql-warningbox>
</li>
<li>
<p>Click through the subsequent pages:</p>
<ul>
<li>Accept the terms and conditions.</li>
<li>Do not add recovery options or two-factor authentication (because this is a temporary account).</li>
<li>Do not sign up for free trials.</li>
</ul>
</li>
</ol>
<p>After a few moments, the Cloud Console opens in this tab.</p>
<ql-infobox>
<strong>Note:</strong> You can view the menu with a list of Google Cloud Products and Services by clicking the <strong>Navigation menu</strong> at the top-left.
<img alt="Navigation menu icon" src="https://cdn.qwiklabs.com/nUxFb6oRFr435O3t6V7WYJAjeDFcrFb16G9wHWp5BzU%3D">
</ql-infobox>
<h2 id="step4">Task 1. Create a Cloud SQL for PostgreSQL instance with CMEK enabled</h2>
<p>In this task you will create a Cloud SQL for PostgreSQL instance with CMEK enabled. It is imperative that you keep the keys safe as you cannot manage your database without them.</p>
<h3>Create a per-product, per-project service account for Cloud SQL</h3>
<p>You can create the service account you require for Cloud SQL CMEK using the <code>gcloud beta services identity create</code> command.</p>
<ol>
<li>In Cloud Shell, run:</li>
</ol>
<ql-code-block language="bash">
export PROJECT_ID=$(gcloud config list --format 'value(core.project)')
gcloud beta services identity create \
    --service=sqladmin.googleapis.com \
    --project=$PROJECT_ID
</ql-code-block>
<ol start="2">
<li>Click the <strong>Authorize</strong> button if prompted.</li>
</ol>
<p>This creates the service account that you will bind to the CMEK in a later step.</p>
<h3>Create a Cloud Key Management Service keyring and key</h3>
<p>In this step you will create a Cloud KMS keyring and key to use with CMEK.</p>
<ol>
<li>
<p>In Cloud Shell, to create the Cloud KMS keyring, run:</p>
<ql-code-block language="bash">
export KMS_KEYRING_ID=cloud-sql-keyring
export ZONE=$(gcloud compute instances list --filter="NAME=bastion-vm" --format=json | jq -r .[].zone | awk -F "/zones/" '{print $NF}')
export REGION=${ZONE::-2}
gcloud kms keyrings create $KMS_KEYRING_ID \
 --location=$REGION
</ql-code-block>
</li>
<li>
<p>In Cloud Shell, to create the Cloud KMS key, run:</p>
<ql-code-block language="bash">
export KMS_KEY_ID=cloud-sql-key
gcloud kms keys create $KMS_KEY_ID \
--location=$REGION \
--keyring=$KMS_KEYRING_ID \
--purpose=encryption
</ql-code-block>
</li>
<li>
<p>In Cloud Shell, to bind the key to the service account, run:</p>
</li>
</ol>
<ql-code-block language="bash" nowrap>
export PROJECT_NUMBER=$(gcloud projects describe ${PROJECT_ID} \
    --format 'value(projectNumber)')
gcloud kms keys add-iam-policy-binding $KMS_KEY_ID \
    --location=$REGION \
    --keyring=$KMS_KEYRING_ID \
    --member=serviceAccount:service-${PROJECT_NUMBER}@gcp-sa-cloud-sql.iam.gserviceaccount.com \
    --role=roles/cloudkms.cryptoKeyEncrypterDecrypter
</ql-code-block>
<p>The service account name is the same name that was returned by the <code>gcloud beta services identity create</code> command in the previous sub-task.</p>
<h3>Create a Cloud SQL instance with CMEK enabled</h3>
<p>In this step you will create a Cloud SQL for PostgreSQL instance with CMEK enabled. It is not possible to patch an existing instance to enable CMEK, so you should bear this in mind if you plan to use CMEK to encrypt your data.</p>
<p>In order to access your Cloud SQL instance from external development or application environments, you can configure the Cloud SQL instance with a public IP address and control access by allowlisting the IP address of those environments. This limits access to the public interface to those address ranges that you specify.</p>
<p>You will treat the Compute Engine VM instance in the lab as a development environment and will therefore need the to allow list the external IP address of that instance. You will also add the external IP address of the Cloud Shell to the allowlist to make it easier to complete tasks later in the lab.</p>
<ol>
<li>In Cloud Shell, find the external IP address of the <code>bastion-vm</code> VM instance:</li>
</ol>
<ql-code-block language="bash">
export AUTHORIZED_IP=$(gcloud compute instances describe bastion-vm \
    --zone=$ZONE \
    --format 'value(networkInterfaces[0].accessConfigs.natIP)')
echo Authorized IP: $AUTHORIZED_IP
</ql-code-block>
<ol start="2">
<li>In Cloud Shell, find the external IP address of the Cloud Shell:</li>
</ol>
<ql-code-block language="bash">
export CLOUD_SHELL_IP=$(curl ifconfig.me)
echo Cloud Shell IP: $CLOUD_SHELL_IP
</ql-code-block>
<ol start="3">
<li>In Cloud Shell, create your Cloud SQL for PostgreSQL instance with:</li>
</ol>
<ql-code-block language="bash">
export KEY_NAME=$(gcloud kms keys describe $KMS_KEY_ID \
    --keyring=$KMS_KEYRING_ID --location=$REGION \
    --format 'value(name)')
export CLOUDSQL_INSTANCE=postgres-orders
gcloud sql instances create $CLOUDSQL_INSTANCE \
    --project=$PROJECT_ID \
    --authorized-networks=${AUTHORIZED_IP}/32,$CLOUD_SHELL_IP/32 \
    --disk-encryption-key=$KEY_NAME \
    --database-version=POSTGRES_13 \
    --cpu=1 \
    --memory=3840MB \
    --region=$REGION \
    --root-password=supersecret!
</ql-code-block>
<ol start="4">
<li>Enter 'y' if asked after entering the command.</li>
</ol>
<ql-activity-tracking step="1">
    Create a Cloud SQL instance with CMEK enabled
</ql-activity-tracking>
<h2 id="step5">Task 2. Enable and configure pgAudit on a Cloud SQL for PostgreSQL database</h2>
<p>In this task you will enable and configure the pgAudit database extension which enables fine-grained control of logging of all types of database activity.</p>
<ol>
<li>In Cloud Shell enter the following to add the pgAudit database flags to your Cloud SQL instance:</li>
</ol>
<ql-code-block language="bash" nowrap>
gcloud sql instances patch $CLOUDSQL_INSTANCE \
    --database-flags cloudsql.enable_pgaudit=on,pgaudit.log=all
</ql-code-block>
<ol start="2">
<li>
<p>Hit enter to confirm and continue. Wait a minute for the patch command to complete before continuing.</p>
</li>
<li>
<p>In Cloud Console, on the <strong>Navigation menu</strong> (<img alt="Navigation menu icon" src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D">), click <strong>Databases</strong> &gt; <strong>SQL</strong> and click on the Cloud SQL instance named <code>postgres-orders</code>.</p>
</li>
<li>
<p>In the Cloud SQL <strong>Overview</strong> panel, top menu, click <strong>Restart</strong> and <strong>Restart</strong> again in the pop-up dialog.</p>
</li>
</ol>
<p>It will take a minute to restart your Cloud SQL for PostgreSQL instance, then continue below.</p>
<ol start="5">
<li>
<p>In Cloud Console, in the <strong>Connect to this instance</strong> section, click <strong>Open Cloud Shell</strong>. A command will be auto-populated to the Cloud Shell.</p>
</li>
<li>
<p>Run that command and enter the password <code>supersecret!</code> when prompted. A <strong>psql</strong> session will start in Cloud Shell.</p>
</li>
<li>
<p>In <strong>psql</strong>, to create the <code>orders</code> database and enable the pgAudit extension to log all reads and writes, run:</p>
</li>
</ol>
<ql-code-block language="postgresql">
CREATE DATABASE orders;
\c orders;
</ql-code-block>
<ol start="8">
<li>
<p>Enter the password <code>supersecret!</code> again.</p>
</li>
<li>
<p>In <strong>psql</strong>, to create and configure the database extension, run:</p>
</li>
</ol>
<ql-code-block language="postgresql">
CREATE EXTENSION pgaudit;
ALTER DATABASE orders SET pgaudit.log = 'read,write';
</ql-code-block>
<h3>Enable Audit Logging in Cloud Console</h3>
<p>In this step you will enable Audit Logging in Cloud Console.</p>
<ol>
<li>
<p>In Cloud Console, on the <strong>Navigation menu</strong> (<img alt="Navigation menu icon" src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D">), click <strong>IAM &amp; Admin</strong> &gt; <strong>Audit Logs</strong>.</p>
</li>
<li>
<p>In the <strong>Filter</strong> box, type <code>Cloud SQL</code> and select the entry in the drop-down list.</p>
</li>
<li>
<p>Check the checkbox for <code>Cloud SQL</code> on the left and all the checkboxes in the <strong>Info Panel</strong> on the right.</p>
</li>
<li>
<p>Click the <strong>Save</strong> button in the <strong>Info Panel</strong>.</p>
</li>
</ol>
<h3>Populate a database on Cloud SQL for PostgreSQL</h3>
<p>In this step you will populate the <code>orders</code> database with data provided to you.</p>
<ol>
<li>Click the <strong>+</strong> icon on the Cloud Shell title bar to open a new tab in the Cloud Shell, and in that tab, to download the data and database population scripts, run:</li>
</ol>
<ql-code-block language="bash">
export SOURCE_BUCKET=gs://cloud-training/gsp920
gsutil -m cp ${SOURCE_BUCKET}/create_orders_db.sql .
gsutil -m cp ${SOURCE_BUCKET}/DDL/distribution_centers_data.csv .
gsutil -m cp ${SOURCE_BUCKET}/DDL/inventory_items_data.csv .
gsutil -m cp ${SOURCE_BUCKET}/DDL/order_items_data.csv .
gsutil -m cp ${SOURCE_BUCKET}/DDL/products_data.csv .
gsutil -m cp ${SOURCE_BUCKET}/DDL/users_data.csv .
</ql-code-block>
<ol start="2">
<li>In the same Cloud Shell session, create and populate the database as follows:</li>
</ol>
<ql-code-block language="bash" nowrap>
export CLOUDSQL_INSTANCE=postgres-orders
export POSTGRESQL_IP=$(gcloud sql instances describe $CLOUDSQL_INSTANCE --format="value(ipAddresses[0].ipAddress)")
export PGPASSWORD=supersecret!
psql "sslmode=disable user=postgres hostaddr=${POSTGRESQL_IP}" \
    -c "\i create_orders_db.sql"
</ql-code-block>
<p>It will take a minute for the <code>orders</code> database to be populated.</p>
<ol start="3">
<li>Exit the terminal session in the new tab:</li>
</ol>
<ql-code-block language="bash" nowrap>
exit
</ql-code-block>
<ol start="4">
<li>In your <strong>psql</strong> session in the remaining Cloud Shell tab, to further log all <code>SELECT</code> operations on a particular relation, for example the <code>order_items</code> table, run the following commands:</li>
</ol>
<ql-code-block language="postgresql">
CREATE ROLE auditor WITH NOLOGIN;
ALTER DATABASE orders SET pgaudit.role = 'auditor';
GRANT SELECT ON order_items TO auditor;
</ql-code-block>
<ol start="5">
<li>Run the first <code>SELECT</code> query below :</li>
</ol>
<ql-code>
<ql-code-block language="postgresql" tabtitle="Summary of orders by users">
    SELECT
        users.id  AS users_id,
        users.first_name  AS users_first_name,
        users.last_name  AS users_last_name,
        COUNT(DISTINCT order_items.order_id ) AS order_items_order_count,
        COALESCE(SUM(order_items.sale_price ), 0) AS order_items_total_revenue
    FROM order_items
    LEFT JOIN users ON order_items.user_id = users.id
    GROUP BY 1, 2, 3
    ORDER BY 4 DESC
    LIMIT 500;
    </ql-code-block>
<ql-code-block language="postgresql" tabtitle="Summary by individual product">
    SELECT
        products.id  AS products_id,
        products.name  AS products_name,
        products.sku  AS products_sku,
        products.cost  AS products_cost,
        products.retail_price  AS products_retail_price,
        products.distribution_center_id  AS products_distribution_center_id,
        COUNT(DISTINCT order_items.order_id ) AS order_items_order_count,
        COALESCE(SUM(order_items.sale_price ), 0) AS order_items_total_revenue
    FROM order_items
    LEFT JOIN inventory_items ON order_items.inventory_item_id = inventory_items.id
    LEFT JOIN products ON inventory_items.product_id = products.id
    GROUP BY 1, 2, 3, 4, 5, 6
    ORDER BY 7 DESC
    LIMIT 500;
    </ql-code-block>
<ql-code-block language="postgresql" tabtitle="Orders by distribution center">
    SELECT
        order_items.order_id AS order_id,
        distribution_centers.id  AS distribution_centers_id,
        distribution_centers.name  AS distribution_centers_name,
        distribution_centers.latitude  AS distribution_centers_latitude,
        distribution_centers.longitude  AS distribution_centers_longitude
    FROM order_items
    LEFT JOIN inventory_items ON order_items.inventory_item_id = inventory_items.id
    LEFT JOIN products ON inventory_items.product_id = products.id
    LEFT JOIN distribution_centers ON products.distribution_center_id = distribution_centers.id
    GROUP BY 1, 2, 3, 4, 5
    ORDER BY 2
    LIMIT 500;
    </ql-code-block>
</ql-code>
<ol start="6">
<li>
<p>The output is 500 rows long, so hit <code>q</code> and the colon prompt to return to the <code>orders=&gt;</code> prompt.</p>
</li>
<li>
<p>Repeat the last two steps for the other two queries tabs in the code block.</p>
</li>
<li>
<p>Exit <strong>psql</strong>:</p>
</li>
</ol>
<ql-code-block language="postgresql">
\q
</ql-code-block>
<h3>View pgAudit logs</h3>
<p>In this step you will view the logging of your database updates and queries in the pgAudit logs.</p>
<ol>
<li>
<p>In Cloud Console, on the <strong>Navigation menu</strong> (<img alt="Navigation menu icon" src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D">), click <strong>Operations</strong> &gt; <strong>Logging</strong> &gt; <strong>Logs Explorer</strong>.</p>
</li>
<li>
<p>In the <strong>Query</strong> tab of the <strong>Logs Explorer</strong>, paste the following and click the <strong>Run query</strong> button:</p>
</li>
</ol>
<ql-code-block nowrap templated="">
resource.type="cloudsql_database"
logName="projects/{{{project_0.project_id|(GCP Project)}}}/logs/cloudaudit.googleapis.com%2Fdata_access"
protoPayload.request.@type="type.googleapis.com/google.cloud.sql.audit.v1.PgAuditEntry"
</ql-code-block>
<ol start="3">
<li>In the histogram displayed, you can see the audit activity associated with your DDL inserts and the <code>SELECT</code> queries you ran earlier.</li>
</ol>
<p><img alt="A histogram with seven bars." src="https://cdn.qwiklabs.com/XOYPCu21EZFQviBkuuoDY8P3EKT06csK7rjuPHrjINg%3D"></p>
<ol start="4">
<li>Click on the last bar on the histogram - this corresponds to the <code>SELECT</code> queries you ran.</li>
</ol>
<p>In the <strong>Query results</strong> panel below the histogram, the log entries are listed.</p>
<ol start="5">
<li>Expand a log entry, and under <code>protoPayload.request</code> you will see the <code>SELECT</code> query.</li>
</ol>
<ql-activity-tracking step="2">
    Enable and configure pgAudit on a Cloud SQL for PostgreSQL database
</ql-activity-tracking>
<h2 id="step6">Task 3. Configure Cloud SQL IAM database authentication</h2>
<p>In this task you will configure Cloud SQL IAM database authentication. All of the database access and update tasks you have performed so far have used built-in PostgreSQL user accounts. You can also create Cloud SQL for PostgreSQL users using Cloud IAM accounts. Database users can authenticate to Cloud SQL using Cloud IAM instead of using built-in database accounts and fine-grained permissions at the database level can be granted to those users.</p>
<p>In this task you will configure the lab user account as a Cloud SQL IAM user, grant that user access to the <code>orders.order_items</code> database table using the <strong>postgres</strong> administrator account, and then test access to the <code>orders.order_items</code> database table from the command line using the <strong>psql</strong> command line utility.</p>
<p>The authentication process that is used in this task is explained in detail in the <a href="https://cloud.google.com/sql/docs/postgres/iam-logins#logging-in-as-a-user" target="_blank">IAM authentication documentation for Cloud SQL for PostgreSQL</a>.</p>
<h3>Test database access using a Cloud IAM user before Cloud SQL IAM authentication is configured.</h3>
<p>You will attempt to access the database using a Cloud IAM user before Cloud SQL IAM authentication haas been enabled in order to establish that the Cloud IAM user cannot initially access the data.</p>
<ul>
<li>Test access to the <code>orders</code> database using the lab student account as the username:</li>
</ul>
<ql-code-block language="bash" nowrap>
export USERNAME=$(gcloud config list --format="value(core.account)")
export CLOUDSQL_INSTANCE=postgres-orders
export POSTGRESQL_IP=$(gcloud sql instances describe $CLOUDSQL_INSTANCE --format="value(ipAddresses[0].ipAddress)")
export PGPASSWORD=$(gcloud auth print-access-token)
psql --host=$POSTGRESQL_IP $USERNAME --dbname=orders
</ql-code-block>
<p>This connection attempt will fail and you will see an authentication failed message similar to the following because the Cloud SQL IAM user has not been created yet:</p>
<ql-code-block output="">
psql --host=$POSTGRESQL_IP $USERNAME --dbname=orders
psql: error: connection to server at "35.226.251.234", port 5432 failed: FATAL:  password authentication failed for user "student-01-22fa974575e4@qwiklabs.net"
connection to server at "35.226.251.234", port 5432 failed: FATAL:  password authentication failed for user "student-01-22fa974575e4@qwiklabs.net"
</ql-code-block>
<p>Cloud SQL IAM database authentication uses OAuth 2.0 access tokens is the Cloud IAM user password, which are short-lived and only valid for one hour so you should regenerate the token every time you need to authenticate. The access token should always be passed into the <strong>psql</strong> command using the <strong>PGPASSWORD</strong> environment variable as the buffer for the <strong>psql</strong> password parameter is too small to hold the OAuth 2.0 token string.</p>
<h3>Create a Cloud SQL IAM user</h3>
<p>You will now create a Cloud SQL IAM user and confirm that Cloud SQL IAM user authentication has been enabled.</p>
<ol>
<li>
<p>In Cloud Console, on the <strong>Navigation menu</strong> (<img alt="Navigation menu icon" src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D">), click <strong>Databases</strong> &gt; <strong>SQL</strong> and click on the Cloud SQL instance named <code>postgres-orders</code>.</p>
</li>
<li>
<p>In the Cloud SQL <strong>Overview</strong> panel, in the <strong>Configuration</strong> panel note that the <strong>Database flags</strong> list includes <strong>pgAudit.log</strong> and <strong>cloudsql.enable_pgaudit</strong> only.</p>
</li>
<li>
<p>Click <strong>Users</strong> to open the <strong>Users</strong> panel.</p>
</li>
<li>
<p>Click <strong>Add user account</strong>.</p>
</li>
<li>
<p>Select <strong>Cloud IAM</strong>.</p>
</li>
<li>
<p>In the <strong>Principal</strong> box enter the lab student name.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>Wait for the new user to be added.</p>
</li>
<li>
<p>Click <strong>Overview</strong> and now note that <strong>cloudsql.iam_authentication</strong> has been added to the list of database flags.</p>
</li>
</ol>
<h3>Grant the Cloud IAM user access to a Cloud SQL database table</h3>
<p>You will now connect to the <code>postgres-orders</code> instance using the built in <code>postgres</code> administrator account and grant access to the <code>orders.order_items</code> table to the Cloud IAM user.</p>
<ol>
<li>In the Cloud Shell connect to the <code>postgres-orders</code> Cloud SQL instance as the <code>postgres</code> administrative user:</li>
</ol>
<ql-code-block language="bash" nowrap>
gcloud sql connect postgres-orders --user=postgres --quiet
</ql-code-block>
<ol start="2">
<li>
<p>When prompted enter the password: <code>supersecret!</code>.</p>
</li>
<li>
<p>Enter the following SQL command to switch to the <code>orders</code> database:</p>
<ql-code-block language="postgresql" nowrap templated="">
\c orders
</ql-code-block>
</li>
</ol>
<p>When prompted for a password enter <code>supersecret!</code> again.</p>
<ol start="4">
<li>
<p>Enter the following SQL command to grant the lab user all permissions on the <code>order_items</code> table. The Cloud IAM username for the lab has been inserted into this query for you.</p>
<ql-code-block language="postgresql" nowrap templated="">
GRANT ALL PRIVILEGES ON TABLE order_items TO "{{{user_0.username|[IAM Username]}}}";
\q
</ql-code-block>
</li>
</ol>
<h3>Test database access using a Cloud IAM user after Cloud SQL IAM authentication is configured.</h3>
<p>You will repeat the attempt to access the database using a Cloud IAM user after Cloud SQL IAM authentication has been enabled in order to establish that the Cloud IAM user can now access the data.</p>
<p>You can now test access to the database again using the Cloud IAM user instead of the built-in <code>postgres</code> user:</p>
<ol>
<li>In the Cloud Shell enter the following command to connect to the database using the Cloud IAM database user:</li>
</ol>
<ql-code-block language="bash" nowrap>
export PGPASSWORD=$(gcloud auth print-access-token)
psql --host=$POSTGRESQL_IP $USERNAME --dbname=orders
</ql-code-block>
<p>This connection succeeds and you are now connected the instance using Cloud IAM user authentication.</p>
<ol start="2">
<li>Test your access permission by running this query:</li>
</ol>
<ql-code-block language="postgresql" nowrap>
SELECT COUNT(*) FROM order_items;
</ql-code-block>
<p>This will now return a successful result:</p>
<ql-code-block output="">
orders=&gt; SELECT COUNT(*) FROM order_items;
 count
--------
 198553
(1 row)
</ql-code-block>
<ol start="3">
<li>Confirm that you do not have access to one of the other tables by running this query:</li>
</ol>
<ql-code-block language="postgresql" nowrap>
SELECT COUNT(*) FROM users;
</ql-code-block>
<p>This will now return a successful result:</p>
<ql-code-block output="">
orders=&gt; SELECT COUNT(*) FROM users;
ERROR:  permission denied for table users
</ql-code-block>
<ql-activity-tracking step="3">
    Configure Cloud SQL IAM database authentication
</ql-activity-tracking>
<h2 id="step7">Congratulations!</h2>
<p>You completed the lab! In this lab, you secured data at rest in Cloud SQL for PostgreSQL using a customer managed encryption key, enabled pgAudit, and configured Cloud SQL IAM database user authentication.</p>

<h3>Finish your quest</h3>
<p>This self-paced lab is part of the <a href="https://www.cloudskillsboost.google/quests/186" target="_blank">Manage PostgreSQL Databases on Cloud SQL</a> quest. A quest is a series of related labs that form a learning path. Completing this quest earns you a badge to recognize your achievement. You can make your badge or badges public and link to them in your online resume or social media account. <a href="https://www.cloudskillsboost.google/quests/186/enroll" target="_blank">Enroll in a quest</a> or any quest that contains this lab and get immediate completion credit.  See the <a href="http://cloudskillsboost.google/catalog" target="_blank">Google Cloud Skills Boost catalog</a> to see all available quests.</p>

<h2 id="step8">End your lab</h2>
<p>When you have completed your lab, click <strong>End Lab</strong>. Your account and the resources you've used are removed from the lab platform.</p>
<p>You will be given an opportunity to rate the lab experience. Select the applicable number of stars, type a comment, and then click <strong>Submit</strong>.</p>
<p>The number of stars indicates the following:</p>
<ul>
<li>1 star = Very dissatisfied</li>
<li>2 stars = Dissatisfied</li>
<li>3 stars = Neutral</li>
<li>4 stars = Satisfied</li>
<li>5 stars = Very satisfied</li>
</ul>
<p>You can close the dialog box if you don't want to provide feedback.</p>
<p>For feedback, suggestions, or corrections, please use the <strong>Support</strong> tab.</p>
<p><strong>Manual Last Updated: October 10, 2022</strong></p>
<p><strong>Lab Last Tested: September 13, 2022</strong></p>
<p>Copyright 2023 Google LLC All rights reserved. Google and the Google logo are trademarks of Google LLC. All other company and product names may be trademarks of the respective companies with which they are associated.</p>

</div>
</div>


<div class='lab-content__end-lab-button js-end-lab-button-container hidden'>
<ql-lab-control-button class='js-end-lab-button' running></ql-lab-control-button>
</div>
<!-- / TODO: Move recommendations into the end lab modal -->
</div>
<div aria-label='Lab Table of Contents' class='outline-container' id='js-outline-container' role='navigation'>
<ul class='lab-content__outline js-lab-content-outline'>
<li><a href="#step1">GSP920</a></li><li><a href="#step2">Overview</a></li><li><a href="#step3">Setup and requirements</a></li><li><a href="#step4">Task 1. Create a Cloud SQL for PostgreSQL instance with CMEK enabled</a></li><li><a href="#step5">Task 2. Enable and configure pgAudit on a Cloud SQL for PostgreSQL database</a></li><li><a href="#step6">Task 3. Configure Cloud SQL IAM database authentication</a></li><li><a href="#step7">Congratulations!</a></li><li><a href="#step8">End your lab</a></li>
</ul>
</div>
</ql-drawer-content>
</ql-drawer-container>
</ql-drawer-content>
</ql-drawer-container>
<ql-snackbar id='alert-snackbar'></ql-snackbar>



</div>
</main>

<span class='hidden' id='flash-sibling-before'></span>
<ql-snackbar></ql-snackbar>


<ql-dialog headline='Score Details' icon='task_alt' id='jupyter-feedback-modal'>
<iframe id='jupyter-feedback-frame' srcdoc='' title='Jupyter Feedback'></iframe>
</ql-dialog>

<div class='modal fade' id='lab-details-modal'>
<div class='modal-container'>
<div class='modal-content mdl-shadow--24dp'>
<div class='modal-body'>
<p class='l-mbm'>
In this lab you will deploy a new Cloud SQL instance using a customer-managed encryption key (CMEK). You will configure pgAudit to selectively record and track SQL operations performed against that instance, then you will configure and test Cloud SQL IAM database authentication.
</p>
<p>
This lab is included in the quest
<a href="/quests/186">Manage PostgreSQL Databases on Cloud SQL</a>.
If you complete this lab you&#39;ll receive credit for it when you enroll in this quest.
</p>
<p class='small-label l-mbs'>
<strong>
Duration:
</strong>
0m setup
&middot;
60m access
&middot;
40m completion
</p>
<p class='small-label l-mbs'>
<strong>AWS Region:</strong>
[] <strong></strong>
</p>
<p class='small-label l-mbs'>
<span><strong>Levels: </strong>introductory</span>
</p>
<p class='small-label'>
<strong>
Permalink:
</strong>
<a href="https://googlecoursera.qwiklabs.com/catalog_lab/4200">https://googlecoursera.qwiklabs.com/catalog_lab/4200</a>
</p>
</div>
<div class='modal-actions'>
<a class='button button--text' data-dismiss='modal'>
Got It
</a>
</div>


</div>
</div>
<iframe class='l-ie-iframe-fix' tabindex='-1' title='modal'></iframe>
</div>
<ql-dialog headline='How satisfied are you with this lab?&lt;span aria-hidden=&quot;true&quot;&gt;*&lt;/span&gt;' id='lab-review-dialog'>
<form class="simple_form js-lab-review-form" id="new_lab_review" action="/lab_reviews" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" autocomplete="off" /><div aria-labelledby='lab-review-dialog' aria-required='true' aria-valuemax='5' aria-valuemin='0' aria-valuenow='0' class='rateit js-rateit' data-rateit-max='5' data-rateit-min='0' data-rateit-resetable='false' data-rateit-step='1' data-rateit-value='0' id='lab-review-rateit' role='slider' tabindex='0'></div>
<div class='l-mtm'>

<div class="control-group hidden lab_review_user_id"><div class="controls"><input class="hidden" autocomplete="off" type="hidden" value="12197799" name="lab_review[user_id]" id="lab_review_user_id" /></div></div>
<div class="control-group hidden lab_review_classroom_id"><div class="controls"><input class="hidden" autocomplete="off" type="hidden" name="lab_review[classroom_id]" id="lab_review_classroom_id" /></div></div>
<div class="control-group hidden lab_review_lab_id"><div class="controls"><input class="hidden" autocomplete="off" type="hidden" value="4200" name="lab_review[lab_id]" id="lab_review_lab_id" /></div></div>
<div class="control-group hidden lab_review_focus_id"><div class="controls"><input class="hidden" autocomplete="off" type="hidden" name="lab_review[focus_id]" id="lab_review_focus_id" /></div></div>
<div class="control-group hidden lab_review_rating"><div class="controls"><input class="hidden js-rating-input" autocomplete="off" type="hidden" name="lab_review[rating]" id="lab_review_rating" /></div></div>
<div class="control-group text optional lab_review_comment"><label class="text optional control-label" for="lab_review_comment">Additional Comments</label><div class="controls"><textarea class="text optional" name="lab_review[comment]" id="lab_review_comment">
</textarea></div></div>
</div>
</form><ql-button disabled id='submit' label='Submit' slot='action' text></ql-button>
</ql-dialog>

<ql-dialog headline='All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?' icon='error_outline' id='js-lab-are-you-sure-dialog'>
<ql-button id='js-are-you-sure-button' label='Submit' slot='action' text></ql-button>
</ql-dialog>


<script>
  $(function() {
    ql.initMaterialInputs();
    initChosen();
    initSearch();
    initTabs();
    ql.list.init();
    ql.favoriting.init();
    ql.header.myAccount.init();
    initTooltips();
    ql.autocomplete.init();
    ql.modals.init();
    ql.toggleButtons.init();
    ql.analytics.init();
    ql.chat.init();
  ql.jumpContent.init();
  ql.labControlPanel.addRecaptchaErrorHandler();
  initLabContent();
  ql.labOutline.links.init();
  initLabReviewModal();
  initLabReviewTranslations( {"star_amount_1":"1 of 5 stars","star_amount_2":"2 of 5 stars","star_amount_3":"3 of 5 stars","star_amount_4":"4 of 5 stars","star_amount_5":"5 of 5 stars"} )
  ql.labAssessment.init();
  ql.labData.init();
  initLabTranslations( {"are_you_sure":"All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?","in_progress":"*In Progress*","ending":"*Ending*","starting":"*Starting, please wait*","end_concurrent_labs":"Sorry, you can only run one lab at a time. To start this lab, please confirm that you want all of your existing labs to end.","copied":"Copied","no_resource":"Error retrieving resource.","no_support":"No Support","mac_press":"Press ⌘-C to copy","thanks_review":"Thanks for reviewing this lab.","windows_press":"Press Ctrl-C to copy","days":"days"} );
  ql.labRun.init();
  ql.navPanel.init();
  ql.navigation.init();
  
  });
</script>

</body>
</html>

